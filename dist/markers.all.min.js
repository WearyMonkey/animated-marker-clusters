!function t(n,e,o){function i(s,a){if(!e[s]){if(!n[s]){var _="function"==typeof require&&require;if(!a&&_)return _(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=e[s]={exports:{}};n[s][0].call(l.exports,function(t){var e=n[s][1][t];return i(e?e:t)},l,l.exports,t,n,e,o)}return e[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(t){window.wm={Markers:t("./../markers.js"),Point:t("./../point.js"),Line:t("./../line.js"),mapConnectors:{mapBox:t("./../map-connectors/mapbox.js"),google:t("./../map-connectors/google.js")}}},{"./../line.js":4,"./../map-connectors/google.js":5,"./../map-connectors/mapbox.js":6,"./../markers.js":7,"./../point.js":8}],2:[function(t,n){function e(t){var n,o,i,r,s,a=Number.MAX_VALUE;if(!t._bestPoint)if(o=t.getParent(),i=o&&e(o),i&&null!=t._points[i._id])t._bestPoint=i;else for(n in t._points)t._points.hasOwnProperty(n)&&(s=t._points[n],r=d(t,s,t._center),a>r&&(t._bestPoint=s,a=r));return t._bestPoint}function o(t,n){var e,o,r,s,a={},_=t._zoom+t._zoomRange;if(!(_>t._geo.maxZoom)){for(e=0;e<n.length;++e)r=n[e],o=i(t,r._latLng,r._latLng,t._children),o||(o=new f(t,_,t._geo.maxZoom-_+1,t._geo,t._settings),t._children.push(o)),a[o._id]=a[o._id]||[],a[o._id].push(r);for(e=0;e<t._children;++e)o=t._children[e],s=a[o._id],s&&o.addPoints(s)}}function i(t,n,e,o,i){for(var s,a=Number.MAX_VALUE,_=0;_<o.length;_++){var u=o[_]._bounds,l=d(t,n,t._geo.getBoundsCenter(u)),g=i||Math.pow(o[_]._settings.zoomBoxes[o[_]._zoom].max,2);if(g>l){var c=r(t,e,u);a>c&&(s=o[_],a=c)}}return s}function r(t,n,e){var o=t._geo.createBounds();t._geo.extendBounds(o,e),t._geo.extendBounds(o,n);var i=t._geo.getBoundsSpan(o),r=t._geo.getBoundsSpan(e);return i._lat*i._lng-r._lat*r._lng}function s(t,n,e){var o,r,u,g,d=[];if(!t._children.length){for(o in t._points)t._points.hasOwnProperty(o)&&(u=new f(t,t._geo.maxZoom,1,t._geo,t._settings),u.addPoints([t._points[o]]),t._children.push(u));if(0==--e)return!0}for(t._children.length<3?g=t._children:(g=[a(t,t._center,t._children)],g.push(a(t,g[0]._center,t._children))),o=0;o<g.length;++o)u=new f(t,n,e,t._geo,t._settings),d.push(u),t._geo.extendBounds(u._bounds,g[o]._bounds);for(o=0;o<t._children.length;++o){var c=t._children[o];u=i(t,t._geo.getBoundsCenter(c._bounds),c._bounds,d,Number.MAX_VALUE),u||(u=new f(t,n,e,t._geo,t._settings),d.push(u)),u._children.push(c)}for(t._children=d,t._pointToChild={},o=0;o<d.length;++o){for(u=d[o],r=0;r<u._children.length;++r)_(t,u,u._children[r]);u._center=t._geo.getBoundsCenter(u._bounds),u._zoomRange=l(u),u._zoomRange<e&&s(u,u._zoom+u._zoomRange,e-u._zoomRange)}return!0}function a(t,n,e){for(var o,i=0,r=0;r<e.length;++r){var s=e[r],a=d(t,n,s._center);a>i&&(i=a,o=s)}return o}function _(t,n,e){t._geo.extendBounds(n._bounds,e._bounds),e._parent=n;for(var o in e._points)if(e._points.hasOwnProperty(o)){var i=e._points[o];n._points[i._id]=i,n._pointToChild[i._id]=e,t._pointToChild[i._id]=n}}function u(t){if(!t._parent)return!1;var n,e=t._parent._children,o=t._zoom;for(n=0;n<e.length;++n)e[n]==t&&e.splice(n,1);for(n=0;n<t._children.length;++n){var i=t._children[n];i._zoomRange+=i._zoom-o,i._zoom=o,i._parent=t._parent,e.push(i)}return!0}function l(t){var n,e=t._geo.getBoundsSpan(t._bounds),o=t._zoom,i=t._zoom+t._zoomRange-1;for(n=e._lat>e._lng?e._lat:e._lng;i>o&&t._settings.zoomBoxes[i].max<n;)i--;return i-o+1}function g(t){if(!f.zoomBoxes)for(var n=f.zoomBoxes=[],e=84.375,o=112.6,i=1,r=0;r<=t.maxZoom;r++)n[r]={min:e/i,max:o/i},i<<=1;return f.zoomBoxes}function d(t,n,e){var o=null!=n._lat?n:t._geo.getLatLng(n._latLng||n),i=null!=e._lat?e:t._geo.getLatLng(e._latLng||e);return c(o._lat,o._lng,i._lat,i._lng)}function c(t,n,e,o){var i=t-e,r=n-o;return i*i+r*r}var p=t("./utils.js"),h=1,f=function(t,n,e,o,i){this._parent=t,this._settings=i,this._geo=o,this._id=h++,this._zoom=n,this._zoomRange=e,this._children=[],this._points={},this._pointToChild={},this._connections=[],this._bounds=o.createBounds(),this._center=o.createLatLng(0,0)};p.extend(f,{States:{Normal:0,Collapsed:1,Expanded:2},makeRootCluster:function(t){return new f(null,0,t.maxZoom+1,t,{zoomBoxes:g(t)})}}),p.extend(f.prototype,{getAncestors:function(){for(var t=[],n=this;n=n._parent;)t.push(n);return t},getBounds:function(){return this._bounds},getCenter:function(){return this._center},getDisplayCenter:function(){return e(this)._latLng},getPoints:function(){var t=[];for(var n in this._points)this._points.hasOwnProperty(n)&&t.push(this._points[n]);return t},getMarker:function(){return this._marker},getParent:function(){return this._parent},getState:function(){return this._state},setState:function(t,n){if(this._state=t,n)for(var e=0;e<this._children.length;++e)this._children[e].setState(t,!0)},getZoomRange:function(){return{from:this._zoom,to:this._zoom+this._zoomRange-1}},isInZoomRange:function(t){return t>=this._zoom&&t<this._zoom+this._zoomRange},removePoints:function(t){var n,e=!1;for(n=0;n<t.length;++n){var o=t[n];this._points[o._id]&&(delete this._points[o._id],e=!0,this._parent&&delete this._parent._pointToChild[o._id])}if(e){for(n=0;n<this._children.length;++n){var i=this._children[n];i.removePoints(t)||(this._children.splice(n,1),--n)}this._bestPoint=null,this._bounds=this._geo.createBounds();var r=0;for(var s in this._points)this._points.hasOwnProperty(s)&&(this._geo.extendBounds(this._bounds,this._points[s]._latLng),r+=1);return!!r}return!0},addPoints:function(t){var n,e=!1;for(n=0;n<t.length;++n){var i=t[n];this._points[i._id]||(this._points[i._id]=i,this._geo.extendBounds(this._bounds,i._latLng),this._parent&&(this._parent._pointToChild[i._id]=this),e=!0)}if(e){this._bestPoint=null,this._center=this._geo.getBoundsCenter(this._bounds),o(this,t);var r=this._zoomRange;this._zoomRange=l(this),this._zoomRange<r&&s(this,this._zoom+this._zoomRange,r-this._zoomRange),0==this._zoomRange&&u(this)}},addLine:function(t){for(var n=this._pointToChild,e={},o=1;o<t._points.length;++o){var i=t._points[o]._id,r=t._points[o-1]._id,s=n[i],a=n[r];s&&a&&s!=a&&this._connections.push({_id:h++,_pointId1:i,_pointId2:r,_cluster:this,_line:t}),s&&(e[s._id]||(e[s._id]=!0,s.addLine(t)))}},removeLine:function(t){for(var n={},e=this._connections,o=0;o<e.length;++o){var i=e[o];if(i._line==t){e.splice(o--,1);var r=this._pointToChild[i._pointId1],s=this._pointToChild[i._pointId2];n[r._id]||r.removeLine(t),n[s._id]||s.removeLine(t),n[r._id]=!0,n[s._id]=!0}}}}),n.exports=f},{"./utils.js":9}],3:[function(t){function n(t,o,i,r,s){if(t._geo.boundsIntersects(t._bounds,o)){var _=t.isInZoomRange(i)&&t._state!=a.Expanded,u=!t._children.length||t._state==a.Collapsed;if(u||_)r.push(t);else{e(t,s);for(var l=0;l<t._children.length;++l)n(t._children[l],o,i,r,s)}return r}}function e(t,n){for(var e=0;e<t._connections.length;e++){var o=t._connections[e],i=n[o._pointId1]=n[o._pointId1]||{};i[o._pointId2]=o}}function o(t,n){var e,o,r,s=[],a={};for(var _ in t)if(t.hasOwnProperty(_)){e=t[_];for(var u in e)if(e.hasOwnProperty(u)&&(r=e[u],!a[r._id])){for(a[r._id]=!0,s.push(r),r._displayCluster1=r._cluster._pointToChild[r._pointId1],r._displayCluster2=r._cluster._pointToChild[r._pointId2];o=i(n,r._displayCluster1,_);)r._displayCluster1=o;for(;o=i(n,r._displayCluster2,u);)r._displayCluster2=o}}return s}function i(t,n,e){var o=n.isInZoomRange(t)&&n._state!==a.Expanded,i=!n._pointToChild[e]||n._state===a.Collapsed;return o||i?void 0:n._pointToChild[e]}var r=t("./utils.js"),s=t("./cluster.js"),a=s.States;r.extend(s.prototype,{getContainedClustersAndConnections:function(t,i){for(var r=[],s={},a=this.getAncestors(),_=a.length-1;_>=0;--_){var u=a[_];u&&u._zoom+u._zoomRange-1<i&&e(u,s)}return n(this,t,i,r,s),{clusters:r,connections:o(s,i)}}})},{"./cluster.js":2,"./utils.js":9}],4:[function(t,n){function e(t){for(var n=[],e=0;e<t.length;++e)n.push(o(t[e]));return n}var o=t("./point"),i=t("./utils.js"),r=1,s=function(t,n){return t instanceof s?t:this instanceof s?(this._id=r++,this._points=e(t),this._data=n,void 0):new s(t,n)};i.extend(s.prototype,{getPoints:function(){return this._points},getData:function(){return this._data}}),n.exports=s},{"./point":8,"./utils.js":9}],5:[function(t,n){n.exports={maxZoom:20,createLatLng:function(t,n){return new google.maps.LatLng(t,n)},getLatLng:function(t){return{_lat:t.lat(),_lng:t.lng()}},getMarketPosition:function(t){return t.getPosition()},setMarkerPosition:function(t,n){t.setPosition(n)},getPolylinePath:function(t){return t.getPath().getArray().slice()},setPolylinePath:function(t,n){t.setPath(new google.maps.MVCArray(n))},showMarker:function(t,n){n.setMap(t)},showPolyline:function(t,n){n.setMap(t)},hideMarker:function(t,n){n.setMap(null)},hidePolyline:function(t,n){n.setMap(null)},createBounds:function(){return new google.maps.LatLngBounds},extendBounds:function(t,n){n instanceof google.maps.LatLng?t.extend(n):n instanceof google.maps.LatLngBounds&&t.union(n)},getBoundsCenter:function(t){return t.getCenter()},boundsIntersects:function(t,n){return t.intersects(n)},getBoundsSpan:function(t){var n=t.toSpan();return{_lat:n.lat(),_lng:n.lng()}},onMapBoundsChange:function(t,n){return google.maps.event.addListener(t,"bounds_changed",n)},offMapsBoundChange:function(){},getMapZoom:function(t){return t.getZoom()},getMapBounds:function(t){return t.getBounds()}}},{}],6:[function(t,n){n.exports={maxZoom:20,createLatLng:function(t,n){return L.latLng(t,n)},getLatLng:function(t){return{_lat:t.lat,_lng:t.lng}},getMarketPosition:function(t){return t.getLatLng()},setMarkerPosition:function(t,n){t.setLatLng(n)},getPolylinePath:function(t){return t.getLatLngs().slice()},setPolylinePath:function(t,n){t.setLatLngs(n)},showMarker:function(t,n){n.addTo(t)},showPolyline:function(t,n){n.addTo(t)},hideMarker:function(t,n){t.removeLayer(n)},hidePolyline:function(t,n){t.removeLayer(n)},createBounds:function(){return L.latLngBounds([])},extendBounds:function(t,n){t.extend(n)},getBoundsCenter:function(t){return t.getCenter()},boundsIntersects:function(t,n){return t.getNorthEast()&&n.getNorthEast()?t.intersects(n):!1},getBoundsSpan:function(t){var n=t.getNorthWest()||{lat:0,lng:0},e=t.getSouthEast()||{lat:0,lng:0};return{_lat:n.lat-e.lat,_lng:e.lng-n.lng}},onMapBoundsChange:function(t,n){return t.on("move",n),n},offMapsBoundChange:function(t){map.off("move",t)},getMapZoom:function(t){return t.getZoom()},getMapBounds:function(t){return t.getBounds()}}},{}],7:[function(t,n){function e(t,n,e){return n._keepKey=t._keepKey,t._visibleClusters.push(n),n._marker||(n._marker=t._options.createMarker(n)),e||(e=n.getDisplayCenter()),t._geo.setMarkerPosition(n._marker,e),n._visible||(t._geo.showMarker(t._map,n._marker),n._visible=!0),n._marker}function o(t,n){return n._keepKey=t._keepKey,t._visibleConnections.push(n),n.polyline||(n.polyline=t._options.createPolyline(n._line,n._cluster1,n._cluster2)),t._geo.setPolylinePath(n.polyline,[n._displayCluster1.getDisplayCenter(),n._displayCluster2.getDisplayCenter()]),n._visible||(t._geo.showPolyline(t._map,n.polyline),n._visible=!0),n.polyline}function i(t,n,e){n._marker&&(t._geo.hideMarker(t._map,n._marker),n._visible=!1,e&&delete n._marker)}function r(t,n,e){n.polyline&&(t._geo.hidePolyline(t._map,n.polyline),n._visible=!1,e&&delete n.polyline)}function s(t,n){var i,r=n.getContainedClustersAndConnections(p(t),t._geo.getMapZoom(t._map));for(i=0;i<r.clusters.length;++i)e(t,r.clusters[i]);for(i=0;i<r.connections.length;++i)o(t,r.connections[i])}function a(t,n,o,r){function s(n,o){if(n=r||n,n==o)return!1;if(r||n&&n.getZoomRange().to==d-1){var s=e(t,o,n.getDisplayCenter());if(!s)return console.log("Null Marker"),!1;var a=t._geo.getLatLng(o.getDisplayCenter()),u=t._geo.getLatLng(n.getDisplayCenter());return s.dLat=(a._lat-u._lat)/t._options.animationSteps,s.dLng=(a._lng-u._lng)/t._options.animationSteps,s.inPlace=!1,_.push(s),i(t,n),!0}return e(t,o),!1}var a=n.getContainedClustersAndConnections(p(t),o),_=[],d=t._geo.getMapZoom(t._map),c=u(a,n,s),h=l(t,a.connections,c);g(t,_,h)}function _(t,n,o,i){function r(n,o){if(n=i||n,n==o)return!1;if(i||n&&n.getZoomRange().to==_){var r=e(t,o),s=t._geo.getLatLng(o.getDisplayCenter()),u=t._geo.getLatLng(n.getDisplayCenter());return r.dLat=(u._lat-s._lat)/t._options.animationSteps,r.dLng=(u._lng-s._lng)/t._options.animationSteps,a.push(r),!0}return e(t,o),!1}var s=n.getContainedClustersAndConnections(p(t),o),a=[],_=t._geo.getMapZoom(t._map),d=u(s,n,r),h=l(t,s.connections,d);g(t,a,h,function(){c(t)})}function u(t,n,e){function o(t,n){for(;t;){if(t==n)return!0;t=t.getParent()}return!1}function i(t,i,r){s[i._id]||r&&!o(t,n)||!e(t,i)||(s[i._id]=i)}var r,s={};for(r=0;r<t.clusters.length;++r)i(t.clusters[r]._parent,t.clusters[r],!1);var a=null!==n._parent;for(r=0;r<t.connections.length;r++){var _=t.connections[r];i(_._displayCluster1._parent,_._displayCluster1,a),i(_._displayCluster2._parent,_._displayCluster2,a)}return s}function l(t,n,e){for(var i=[],r=0;r<n.length;++r){var s=n[r],a=o(t,s),_=e[s._displayCluster1._id],u=e[s._displayCluster2._id],l=null,g=null,d=null;a&&(a.dLat1=a.dLng1=a.dLat2=a.dLng2=null,_&&(a.dLat1=_._marker.dLat,a.dLng1=_._marker.dLng,l=t._geo.getMarketPosition(_._marker)),u&&(a.dLat2=u._marker.dLat,a.dLng2=u._marker.dLng,g=t._geo.getMarketPosition(u._marker)),(l||g)&&(d=t._geo.getPolylinePath(a),d[0]=l||d[0],d[1]=g||d[1],t._geo.setPolylinePath(a,d),i.push(a)))}return i}function g(t,n,e,o){var i=0;t._interval=setInterval(function(){if(i<t._options.animationSteps){var r;for(r=0;r<n.length;++r){var s=n[r],a=d(t,t._geo.getMarketPosition(s),s.dLat,s.dLng);t._geo.setMarkerPosition(s,a)}for(r=0;r<e.length;++r){var _=e[r],u=t._geo.getPolylinePath(_);"undefined"!=typeof _.dLat1&&(u[0]=d(t,u[0],_.dLat1,_.dLng1)),"undefined"!=typeof _.dLat2&&(u[1]=d(t,u[1],_.dLat2,_.dLng2)),t._geo.setPolylinePath(_,u)}}else i==t._options.animationSteps&&(clearInterval(t._interval),o&&o());++i},t._options.animationInterval)}function d(t,n,e,o){var i=t._geo.getLatLng(n);return t._geo.createLatLng(i._lat+e,i._lng+o)}function c(t){var n=0,e=t._visibleClusters,o=t._visibleConnections;t._keepKey=(t._keepKey+1)%3735928559,t._visibleClusters=[],t._visibleConnections=[],clearInterval(t._interval);var u=t._geo.getMapZoom(t._map),l=u-t._prevZoom;1==l?a(t,t._clusterRoot,u):-1==l?_(t,t._clusterRoot,u+1):s(t,t._clusterRoot),setTimeout(function(){for(n=0;n<e.length;++n){var s=e[n];s._keepKey!=t._keepKey&&i(t,s)}for(n=0;n<o.length;++n){var a=o[n];a._keepKey!=t._keepKey&&r(t,a)}},0)}function p(t){return t._geo.getMapBounds(t._map)}var h=t("./cluster.js");t("./cluster_search.js");var f=t("./utils.js"),m=t("./point.js"),v=t("./line.js"),L={animationSteps:10,animationInterval:50,debug:!1,createMarker:function(){},createPolyline:function(){}},C=function(t,n){var e=this;this._options=f.extend({},L,n),this._visibleClusters=[],this._visibleConnections=[],this._keepKey=0,this._map=t,this._prevZoom=this._map.getZoom(),this._geo=n.mapConnector||wm.defaultMapConnector&&wm.mapConnectors&&wm.mapConnectors[wm.defaultMapConnector],this._clusterRoot=h.makeRootCluster(this._geo),c(this),this._boundsListener=e._geo.onMapBoundsChange(t,function(){var n=e._geo.getMapZoom(t);0>n||n>e._geo.maxZoom||(c(e),e._prevZoom=n,e._prevBounds=e._geo.getMapBounds(t))})};f.extend(C.prototype,{addLine:function(t,n){return t=v(t),n&&n.addPoints===!0&&this._clusterRoot.addPoints(t._points),this._clusterRoot.addLine(t),t},removeLine:function(t,n){this._clusterRoot.removeLine(t),n&&n.removePoints===!0&&this._clusterRoot.removePoints(t._points)},addPoint:function(t){return t=m(t),this._clusterRoot.addPoints([t]),t},removePoint:function(t){this._clusterRoot.removePoints([t])},addPoints:function(t){for(var n=[],e=0;e<t.length;++e)n.push(m(t[e]));return this._clusterRoot.addPoint(n),n},removePoints:function(t){this._clusterRoot.removePoints(t)},destroy:function(){for(var t=0;t<this._visibleClusters.length;++t)i(this,this._visibleClusters[t],!0);for(t=0;t<this._visibleConnections.length;++t)r(this,this._visibleConnections[t],!0);this._boundsListener&&google.maps.event.removeListener(this._boundsListener)},setClusterState:function(t,n){var e,o=t.getState(),i=n,r=t;if(i!=o){if(n==h.States.Normal){for(;(e=r.getParent(!0))&&e.getState()!==h.States.Normal;)r=e;n=o==h.States.Collapsed?h.States.Expanded:h.States.Collapsed}n==h.States.Collapsed?(_(this,r,this._map.getZoom(),r),r.setState(i,!0)):n==h.States.Expanded&&(r.setState(i,!0),a(this,r,this._map.getZoom(),r))}}}),n.exports=C},{"./cluster.js":2,"./cluster_search.js":3,"./line.js":4,"./point.js":8,"./utils.js":9}],8:[function(t,n){var e=t("./utils.js"),o=1,i=function(t,n){return t instanceof i?t:this instanceof i?(this._id=o++,this._latLng=t,this._data=n,void 0):new i(t,n)};e.extend(i.prototype,{getLatLng:function(){return this._latLng},getData:function(){return this._data}}),n.exports=i},{"./utils.js":9}],9:[function(t,n){n.exports={extend:function(t){for(var n=1;n<arguments.length;++n){var e=arguments[n];for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])}return t}}},{}]},{},[1]);