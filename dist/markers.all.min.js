/**
 * animated-marker-clusters - A library for animated marker clusters on Google, Mapbox or Bing maps
 * @version v0.0.0
 * @link https://github.com/WearyMonkey/animated-marker-clusters
 * @license MIT
 */
!function t(n,e,o){function i(s,a){if(!e[s]){if(!n[s]){var _="function"==typeof require&&require;if(!a&&_)return _(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=e[s]={exports:{}};n[s][0].call(l.exports,function(t){var e=n[s][1][t];return i(e?e:t)},l,l.exports,t,n,e,o)}return e[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(t){window.wm={Markers:t("./../markers.js"),Point:t("./../point.js"),Line:t("./../line.js"),mapConnectors:{mapbox:t("./../map-connectors/mapbox.js"),google:t("./../map-connectors/google.js"),bing:t("./../map-connectors/bing.js")}}},{"./../line.js":4,"./../map-connectors/bing.js":5,"./../map-connectors/google.js":6,"./../map-connectors/mapbox.js":7,"./../markers.js":8,"./../point.js":9}],2:[function(t,n){function e(t){var n,o,i,r,s=Number.MAX_VALUE;if(!t._bestPoint)if(o=t._parent&&e(t._parent),o&&null!=t._points[o._id])t._bestPoint=o;else for(n in t._points)t._points.hasOwnProperty(n)&&(r=t._points[n],i=l(t,r,t._center),s>i&&(t._bestPoint=r,s=i));return t._bestPoint}function o(t,n){var e,o,r,s,a={},_=t._zoom+t._zoomRange;if(!(_>t._geo.maxZoom)){for(e=0;e<n.length;++e)r=n[e],o=i(t,r._latLng,t._children),a[o._id]=a[o._id]||[],a[o._id].push(r);for(e=0;e<t._children;++e)o=t._children[e],s=a[o._id],s&&o.addPoints(s)}}function i(t,n,e){return a(t,n,e,!0)}function r(t,n,e){var o,_,l,c,h=[];if(!t._children.length){for(o in t._points)t._points.hasOwnProperty(o)&&(l=new d(t,t._geo.maxZoom,1,t._geo,t._settings),l.addPoints([t._points[o]]),t._children.push(l));if(0==--e)return!0}for(t._children.length<3?c=t._children:(c=[a(t,t._center,t._children)],c.push(a(t,c[0]._center,t._children))),o=0;o<c.length;++o)l=new d(t,n,e,t._geo,t._settings),h.push(l),l._center=t._geo.getBoundsCenter(c[o]._bounds);for(o=0;o<t._children.length;++o){var g=t._children[o];l=i(t,t._geo.getBoundsCenter(g._bounds),h),l._children.push(g)}for(t._children=h,t._pointToChild={},o=0;o<h.length;++o){for(l=h[o],_=0;_<l._children.length;++_)s(t,l,l._children[_]);l._center=t._geo.getBoundsCenter(l._bounds),l._zoomRange=u(l),l._zoomRange<e&&r(l,l._zoom+l._zoomRange,e-l._zoomRange)}return!0}function s(t,n,e){n._bounds=t._geo.extendBounds(n._bounds,[e._bounds]),e._parent=n;for(var o in e._points)if(e._points.hasOwnProperty(o)){var i=e._points[o];n._points[i._id]=i,n._pointToChild[i._id]=e,t._pointToChild[i._id]=n}}function a(t,n,e,o){for(var i,r=o?Number.MAX_VALUE:0,s=0;s<e.length;++s){var a=e[s],_=l(t,n,a._center);(o&&r>_||!o&&_>r)&&(r=_,i=a)}return i}function _(t){if(!t._parent)return!1;var n,e=t._parent._children,o=t._zoom;for(n=0;n<e.length;++n)e[n]==t&&e.splice(n,1);for(n=0;n<t._children.length;++n){var i=t._children[n];i._zoomRange+=i._zoom-o,i._zoom=o,i._parent=t._parent,e.push(i)}return!0}function u(t){var n,e=t._geo.getBoundsSpan(t._bounds),o=t._zoom,i=t._zoom+t._zoomRange-1;for(n=e._lat>e._lng?e._lat:e._lng;i>o&&t._settings.zoomBoxes[i].max<n;)i--;return i-o+1}function l(t,n,e){var o=null!=n._lat?n:t._geo.getLatLng(n._latLng||n),i=null!=e._lat?e:t._geo.getLatLng(e._latLng||e);return c(o._lat,o._lng,i._lat,i._lng)}function c(t,n,e,o){var i=t-e,r=n-o;return i*i+r*r}var h=t("./utils.js"),g=1,d=function(t,n,e,o,i){this._parent=t,this._settings=i,this._geo=o,this._id=g++,this._zoom=n,this._zoomRange=e,this._children=[],this._points={},this._pointToChild={},this._connections=[],this._bounds=o.createBounds(),this._center=o.createLatLng(0,0),this._expandDepth=0};h.extend(d.prototype,{getBounds:function(){return this._bounds},getCenter:function(){return this._center},getDisplayCenter:function(){return e(this)._latLng},getPoints:function(){var t=[];for(var n in this._points)this._points.hasOwnProperty(n)&&t.push(this._points[n]);return t},getMarker:function(){return this._marker},getParent:function(){return this._parent},getExpandDepth:function(){return this._expandDepth},getZoomRange:function(){return{from:this._zoom,to:this._zoom+this._zoomRange-1}},removePoints:function(t){var n,e=!1;for(n=0;n<t.length;++n){var o=t[n];this._points[o._id]&&(delete this._points[o._id],e=!0,this._parent&&delete this._parent._pointToChild[o._id])}if(e){for(n=0;n<this._children.length;++n){var i=this._children[n];i.removePoints(t)||(this._children.splice(n,1),--n)}this._bestPoint=null,this._bounds=this._geo.createBounds();var r=[];for(var s in this._points)this._points.hasOwnProperty(s)&&r.push(this._points[s]._latLng);return this._bounds=this._geo.extendBounds(this._bounds,r),!!r.length}return!0},addPoints:function(t){var n,e=!1,i=[];for(n=0;n<t.length;++n){var s=t[n];this._points[s._id]||(this._points[s._id]=s,i.push(s._latLng),this._parent&&(this._parent._pointToChild[s._id]=this),e=!0)}if(this._bounds=this._geo.extendBounds(this._bounds,i),e){this._bestPoint=null,this._center=this._geo.getBoundsCenter(this._bounds),o(this,t);var a=this._zoomRange;this._zoomRange=u(this),this._zoomRange<a&&r(this,this._zoom+this._zoomRange,a-this._zoomRange),0==this._zoomRange&&_(this)}},addLine:function(t){for(var n=this._pointToChild,e={},o=1;o<t._points.length;++o){var i=t._points[o]._id,r=t._points[o-1]._id,s=n[i],a=n[r];s&&a&&s!=a&&this._connections.push({_id:g++,_pointId1:i,_pointId2:r,_cluster1:n[i],_cluster2:n[r],_line:t}),s&&(e[s._id]||(e[s._id]=!0,s.addLine(t)))}},removeLine:function(t){for(var n={},e=this._connections,o=0;o<e.length;++o){var i=e[o];if(i._line==t){e.splice(o--,1);var r=this._pointToChild[i._pointId1],s=this._pointToChild[i._pointId2];n[r._id]||r.removeLine(t),n[s._id]||s.removeLine(t),n[r._id]=!0,n[s._id]=!0}}}}),n.exports=d},{"./utils.js":10}],3:[function(t){function n(t,o,i,r,s,a,_,u,l,c,h,g){r=Math.max(null!=t[l]?t[l]:t[c],r-1,0),i=Math.max(null!=t[c]?t[c]:t[l],i-1,0);var d=t._zoom+t._zoomRange-1>=u&&0==r,p=!t._children.length||-1==t._expandDepth;if(p||d)h.push({cluster:t,parent:o});else{t._zoom+t._zoomRange-1>=_&&0==i&&(o=t),g&&e(t,o,i,r,_,u,l,c,g);for(var f=0;f<t._children.length;++f){var m=t._children[f];(a&&m._points[s]||!a&&t._geo.boundsIntersects(m._bounds,s))&&n(m,o,i,r,s,a,_,u,l,c,h,g)}}return h}function e(t,e,o,i,r,s,a,_,u){for(var l=0;l<t._connections.length;l++){var c=t._connections[l];c._displayCluster1=n(c._cluster1,e,o,i,c._pointId1,!0,r,s,a,_,[])[0],c._displayCluster2=n(c._cluster2,e,o,i,c._pointId2,!0,r,s,a,_,[])[0],u.push(c)}}var o=t("./utils.js"),i=t("./cluster.js");o.extend(i.prototype,{getContainedClustersAndConnections:function(t,e,o,i,r){var s=[],a=[];return this._geo.boundsIntersects(this._bounds,t)&&n(this,null,0,0,t,!1,o,e,i,r,s,a),{clusters:s,connections:a}}})},{"./cluster.js":2,"./utils.js":10}],4:[function(t,n){function e(t){for(var n=[],e=0;e<t.length;++e)n.push(o(t[e]));return n}var o=t("./point"),i=t("./utils.js"),r=1,s=function(t,n){return t instanceof s?t:this instanceof s?(this._id=r++,this._points=e(t),this._data=n,void 0):new s(t,n)};i.extend(s.prototype,{getPoints:function(){return this._points},getData:function(){return this._data}}),n.exports=s},{"./point":9,"./utils.js":10}],5:[function(t,n){n.exports={maxZoom:20,createMarker:function(){return new Microsoft.Maps.Pushpin},createPolyline:function(){return new Microsoft.Maps.Polyline([])},createLatLng:function(t,n){return new Microsoft.Maps.Location(t,n)},getLatLng:function(t){return{_lat:t.latitude,_lng:t.longitude}},getMarkerPosition:function(t){return t.getLocation()},setMarkerPosition:function(t,n){t.setLocation(n)},getPolylinePath:function(t){return t.getLocations().slice()},setPolylinePath:function(t,n){t.setLocations(n)},showMarker:function(t,n){t.entities.push(n)},showPolyline:function(t,n){t.entities.push(n)},hideMarker:function(t,n){t.entities.remove(n)},hidePolyline:function(t,n){t.entities.remove(n)},createBounds:function(){return new Microsoft.Maps.LocationRect},extendBounds:function(t,n){for(var e=t.center?[t.getNorthwest(),t.getSoutheast()]:[],o=0;o<n.length;++o){var i=n[o];i instanceof Microsoft.Maps.LocationRect&&i.center?(e.push(i.getNorthwest()),e.push(i.getSoutheast())):e.push(i)}return Microsoft.Maps.LocationRect.fromLocations(e)},getBoundsCenter:function(t){return t.center},boundsIntersects:function(t,n){return t.center&&n.center?t.intersects(n):!1},getBoundsSpan:function(t){return{_lat:t.height||0,_lng:t.width||0}},onMapBoundsChange:function(t,n){Microsoft.Maps.Events.addHandler(t,"viewchangeend",n)},off:function(t){Microsoft.Maps.Events.removeHandler(t)},getMapZoom:function(t){return t.getZoom()},getMapBounds:function(t){return t.getBounds()},onMarkerClicked:function(t,n){return Microsoft.Maps.Events.addHandler(t,"click",n)}}},{}],6:[function(t,n){n.exports={maxZoom:20,createMarker:function(){return new google.maps.Marker},createPolyline:function(){return new google.maps.Polyline},createLatLng:function(t,n){return new google.maps.LatLng(t,n)},getLatLng:function(t){return{_lat:t.lat(),_lng:t.lng()}},getMarkerPosition:function(t){return t.getPosition()},setMarkerPosition:function(t,n){t.setPosition(n)},getPolylinePath:function(t){return t.getPath().getArray().slice()},setPolylinePath:function(t,n){t.setPath(new google.maps.MVCArray(n))},showMarker:function(t,n){n.setMap(t)},showPolyline:function(t,n){n.setMap(t)},hideMarker:function(t,n){n.setMap(null)},hidePolyline:function(t,n){n.setMap(null)},createBounds:function(){return new google.maps.LatLngBounds},extendBounds:function(t,n){for(var e=0;e<n.length;++e){var o=n[e];o instanceof google.maps.LatLng?t.extend(o):o instanceof google.maps.LatLngBounds&&t.union(o)}return t},getBoundsCenter:function(t){return t.getCenter()},boundsIntersects:function(t,n){return t.intersects(n)},getBoundsSpan:function(t){var n=t.toSpan();return{_lat:n.lat(),_lng:n.lng()}},onMapBoundsChange:function(t,n){return google.maps.event.addListener(t,"bounds_changed",n)},off:function(t){google.maps.event.removeListener(t)},getMapZoom:function(t){return t.getZoom()},getMapBounds:function(t){return t.getBounds()},onMarkerClicked:function(t,n){return google.maps.event.addListener(t,"click",n)}}},{}],7:[function(t,n){n.exports={maxZoom:20,createMarker:function(){return L.marker()},createPolyline:function(){return L.polyline([])},createLatLng:function(t,n){return L.latLng(t,n)},getLatLng:function(t){return{_lat:t.lat,_lng:t.lng}},getMarkerPosition:function(t){return t.getLatLng()},setMarkerPosition:function(t,n){t.setLatLng(n)},getPolylinePath:function(t){return t.getLatLngs().slice()},setPolylinePath:function(t,n){t.setLatLngs(n)},showMarker:function(t,n){n.addTo(t)},showPolyline:function(t,n){n.addTo(t)},hideMarker:function(t,n){t.removeLayer(n)},hidePolyline:function(t,n){t.removeLayer(n)},createBounds:function(){return L.latLngBounds([])},extendBounds:function(t,n){for(var e=0;e<n.length;e++)t.extend(n[e]);return t},getBoundsCenter:function(t){return t.getCenter()},boundsIntersects:function(t,n){return t.getNorthEast()&&n.getNorthEast()?t.intersects(n):!1},getBoundsSpan:function(t){var n=t.getNorthWest()||{lat:0,lng:0},e=t.getSouthEast()||{lat:0,lng:0};return{_lat:n.lat-e.lat,_lng:e.lng-n.lng}},onMapBoundsChange:function(t,n){return t.on("move",n),{thing:t,event:"move",callback:n}},off:function(t){t.thing.off(t.event,t.callback)},getMapZoom:function(t){return t.getZoom()},getMapBounds:function(t){return t.getBounds()},onMarkerClicked:function(t,n){return t.on("click",n),{thing:t,event:"click",callback:n}}}},{}],8:[function(t,n){function e(t,n,e){for(var o=new RegExp("^"+n+"(\\..*)?$"),i=0;i<t._listeners.length;++i){var r=t._listeners[i];r.event.match(o)&&r.callback(v.extend({markers:t},e))}}function o(t,n,o){return n._keepKey=t._keepKey,t._visibleClusters.push(n),n._marker||(n._marker=t._options.createMarker(n),n._clickListener=t._geo.onMarkerClicked(n._marker,function(){e(t,"clusterClicked",{cluster:n})})),n._dLat=n._dLng=null,t._geo.setMarkerPosition(n._marker,o||n.getDisplayCenter()),n._visible||(t._geo.showMarker(t._map,n._marker),n._visible=!0,e(t,"clusterShown",{cluster:n})),n._marker}function i(t,n){return n._keepKey=t._keepKey,t._visibleConnections.push(n),n._polyline=n._polyline||t._options.createPolyline(n._line),t._geo.setPolylinePath(n._polyline,[n._displayCluster1.cluster._marker?t._geo.getMarkerPosition(n._displayCluster1.cluster._marker):n._displayCluster1.cluster.getDisplayCenter(),n._displayCluster2.cluster._marker?t._geo.getMarkerPosition(n._displayCluster2.cluster._marker):n._displayCluster2.cluster.getDisplayCenter()]),n._visible||(t._geo.showPolyline(t._map,n._polyline),n._visible=!0,e(t,"lineShown",{line:n._line})),n._polyline}function r(t,n,o){n._marker&&(t._geo.hideMarker(t._map,n._marker),n._visible=!1,e(t,"clusterHidden",{cluster:n}),o&&(t._geo.off(n._clickListener),delete n._marker))}function s(t,n,o){n._polyline&&(t._geo.hidePolyline(t._map,n._polyline),n._visible=!1,e(t,"lineHidden",{line:n._line}),o&&delete n._polyline)}function a(t){var n,e=t._clusterRoot.getContainedClustersAndConnections(p(t),t._zoom,t._prevZoom,"_expandDepth","_oldExpandDepth");for(n=0;n<e.clusters.length;++n)o(t,e.clusters[n].cluster);for(n=0;n<e.connections.length;++n)i(t,e.connections[n])}function _(t){var n=t._clusterRoot.getContainedClustersAndConnections(p(t),t._zoom,t._prevZoom,"_expandDepth","_oldExpandDepth");l(t,n,!1)}function u(t){var n=t._clusterRoot.getContainedClustersAndConnections(p(t),t._prevZoom,t._zoom,"_oldExpandDepth","_expandDepth");l(t,n,!0)}function l(t,n,e){var o;for(o=0;o<n.clusters.length;++o)c(t,n.clusters[o],e);for(o=0;o<n.connections.length;o++){var r=n.connections[o];c(t,r._displayCluster1,e),c(t,r._displayCluster2,e),i(t,r)}h(t)}function c(t,n,e){var i=n.parent,r=n.cluster;if(r._keepKey!=t._keepKey)if(i){var s=e?i:r,a=e?r:i,_=t._geo.getLatLng(s.getDisplayCenter()),u=t._geo.getLatLng(a.getDisplayCenter());o(t,r,a.getDisplayCenter()),r._dLat=(_._lat-u._lat)/t._options.animationSteps,r._dLng=(_._lng-u._lng)/t._options.animationSteps}else o(t,r)}function h(t){function n(){if(o++<t._options.animationSteps){for(e=0;e<t._visibleClusters.length;++e){var r=t._visibleClusters[e],s=t._visibleClusters[e]._marker;if(r._dLat||r._dLng){var a=g(t,t._geo.getMarkerPosition(s),r);t._geo.setMarkerPosition(s,a)}}for(e=0;e<t._visibleConnections.length;++e){var _=t._visibleConnections[e],u=_._displayCluster1.cluster,l=_._displayCluster2.cluster;if(u._dLat||l._dLat||u._dLng||l._dLng){var c=_._polyline,h=t._geo.getPolylinePath(c);h[0]=g(t,h[0],u),h[1]=g(t,h[1],l),t._geo.setPolylinePath(c,h)}}t._timeout=setTimeout(n,i)}else d(t)}var e,o=0,i=t._options.animationInterval;n()}function g(t,n,e){if(!e||!e._dLat&&!e._dLng)return n;var o=t._geo.getLatLng(n);return t._geo.createLatLng(o._lat+e._dLat,o._lng+e._dLng)}function d(t,n){var e=t._visibleClusters,o=t._visibleConnections;t._keepKey=(t._keepKey+1)%3735928559,t._visibleClusters=[],t._visibleConnections=[],clearTimeout(t._timeout),n===!1||t._prevZoom<t._zoom?_(t):n===!0||t._prevZoom>t._zoom?u(t):a(t),setTimeout(function(){var n;for(n=0;n<e.length;++n){var i=e[n];i._keepKey!=t._keepKey&&r(t,i)}for(n=0;n<o.length;++n){var a=o[n];a._keepKey!=t._keepKey&&s(t,a)}},0)}function p(t){return t._geo.getMapBounds(t._map)}function f(t){for(var n=[],e=84.375,o=112.6,i=1,r=0;r<=t.maxZoom;r++)n[r]={min:e/i,max:o/i},i<<=1;return n}var m=t("./cluster.js");t("./cluster_search.js");var v=t("./utils.js"),L=t("./point.js"),C=t("./line.js"),y=function(t,n){var e=this;this._visibleClusters=[],this._visibleConnections=[],this._keepKey=0,this._map=t,this._zoom=this._prevZoom=this._map.getZoom(),this._geo=n.mapConnector||wm.defaultMapConnector&&wm.mapConnectors&&wm.mapConnectors[wm.defaultMapConnector],this._options=v.extend({animationSteps:30,animationInterval:16,createMarker:this._geo.createMarker,createPolyline:this._geo.createPolyline},n),this._clusterRoot=new m(null,0,this._geo.maxZoom+1,this._geo,{zoomBoxes:f(this._geo)}),this._listeners=[],d(this),this._boundsListener=e._geo.onMapBoundsChange(t,function(){var n=e._geo.getMapZoom(t);0>n||n>e._geo.maxZoom||(e._prevZoom=e._zoom,e._zoom=n,d(e),e._prevZoom=n,e._prevBounds=e._geo.getMapBounds(t))})};v.extend(y.prototype,{on:function(t,n){return this._listeners.push({event:t,callback:n}),this},off:function(t,n){for(var e=0;e<this._listeners.length;++e){var o=this._listeners[e];o.event!=t||n&&n!=o.callback||this._listeners.splice(e--,1)}return this},addLine:function(t,n){return t=C(t),n&&n.addPoints===!0&&this._clusterRoot.addPoints(t._points),this._clusterRoot.addLine(t),d(this),t},removeLine:function(t,n){this._clusterRoot.removeLine(t),n&&n.removePoints===!0&&this._clusterRoot.removePoints(t._points),d(this)},addPoint:function(t){return t=L(t),this._clusterRoot.addPoints([t]),d(this),t},removePoint:function(t){this._clusterRoot.removePoints([t]),d(this)},addPoints:function(t){for(var n=[],e=0;e<t.length;++e)n.push(L(t[e]));return this._clusterRoot.addPoint(n),d(this),n},removePoints:function(t){this._clusterRoot.removePoints(t),d(this)},destroy:function(){for(var t=0;t<this._visibleClusters.length;++t)r(this,this._visibleClusters[t],!0);for(t=0;t<this._visibleConnections.length;++t)s(this,this._visibleConnections[t],!0);this._boundsListener&&this._geo.offMapsBoundChange(this._boundsListener)},setClusterState:function(t,n){if("normal"==n)for(;t&&0==t._expandDepth;)t=t._parent;if(t){var e,o=t._expandDepth;t._oldExpandDepth=o,"normal"==n?(t._expandDepth=0,o>0?e=!0:0>o&&(e=!1)):"collapsed"==n?(t._expandDepth=-1,e=!0):"expanded"==n&&(t._expandDepth=1,e=!1),d(this,e),delete t._oldExpandDepth}}}),n.exports=y},{"./cluster.js":2,"./cluster_search.js":3,"./line.js":4,"./point.js":9,"./utils.js":10}],9:[function(t,n){var e=t("./utils.js"),o=1,i=function(t,n){return t instanceof i?t:this instanceof i?(this._id=o++,this._latLng=t,this._data=n,void 0):new i(t,n)};e.extend(i.prototype,{getLatLng:function(){return this._latLng},getData:function(){return this._data}}),n.exports=i},{"./utils.js":10}],10:[function(t,n){n.exports={extend:function(t){for(var n=1;n<arguments.length;++n){var e=arguments[n];for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])}return t}}},{}]},{},[1]);